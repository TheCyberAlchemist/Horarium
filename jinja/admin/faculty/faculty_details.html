{% extends 'admin/base2.html' %}
{% block title%} Department
{% endblock %}

{% block css%}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.24/fh-3.1.8/r-2.2.7/sc-2.0.3/sl-1.3.3/datatables.min.css"/>

<link rel="stylesheet" href="{{static ('form/form2.css')}}">
<link rel="stylesheet" href="{{static ('admin/details/dbtable2.css')}}">

<style>
    td,th {
        font-size: .9rem !important;
    }
</style>
{% endblock %}

{%block scripts%}
<script type="application/javascript" src="{{static ('admin/details/dbtable.js') }}" charset="utf-8"></script>
    <script type="text/javascript">
        activate("{{my_department}}.b");
        $(document).ready(function() {
            {% if update %}
                $('#flush-collapseOne').collapse("show");
            {% endif %}
            let table = $('#example').dataTable({
                "columnDefs" : [{
                    "targets" : [6,7],
                    "orderable" : false,
                    },
                    {responsivePriority: 1, targets: 1},
                    {responsivePriority: 2, targets: 2},
                    {
                        targets : [6,7],
                        className : "all",
                    }
                ],
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                responsive: true
            });
        });
    </script>
{% endblock %}

{% block content %}
<div class="main_content">
      
    <div class="row p-2 ">
        <div class="container navigate">
            <a href="{{url ('admin_home')}}">
                <i class="fas fa-home"></i>    
            </a>
            <i class="fas fa-angle-double-right"></i>
            <a href="{{url ('add_faculty',args=[my_department.id])}}">
                <span class="h6 fw-bold">Add Faculty</span> 
            </a>
            {%if update %}
                <i class="fas fa-angle-double-right"></i>
                <span class="h6 fw-bold">Update Faculty</span> 
            {%endif %}
        </div>
        <div class="col-12 mb-4" style="width:80%;margin: 0 auto;">
            <div class="card shadow-sm components-section" style="border-radius: 1rem;">
                <div class="card-body" style="border-radius: 1rem;">
                    <div class="accordion accordion-flush" id="accordionFlushExample">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="flush-headingOne">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#flush-collapseOne" aria-expanded="false"
                                    aria-controls="flush-collapseOne">
                                    <h5>{% if update %}Update{% else %}Add{% endif %} Faculty</h5>
                                </button>
                            </h2>
                            <div id="flush-collapseOne" class="accordion-collapse collapse"
                                aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                <div class="accordion-body">
                                    <form class="myform" method = "POST">
                                        {{csrf_input}}
                                        <div id="first_page">
                                            <div class="row mb-3 mx-lg-5 mx-sm-0">
                                                <!--////////////////Form Goes here///////////-->
                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                        {% if not update %}
                                                        <div class="form-floating mb-3">
                                                            <input type="text" class="form-control myinputs" id="fname"
                                                                placeholder="-" name="first_name" required autocomplete="off">
                                                            <label for="fname" >First Name</label>
                                                        </div>
                                                        {% else %} 
                                                        <div class="form-floating mb-3">
                                                            <div class="container" id="first_name">
                                                                {{update[0].first_name}}
                                                            </div>
                                                        </div>
                                                        {% endif %}
                                                </div>

                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    {% if not update %}
                                                    <div class="form-floating mb-3">
                                                        <input type="text" class="form-control myinputs" id="lname"
                                                            placeholder="-" name="last_name" required autocomplete="off">
                                                        <label for="lname" >Last Name</label>
                                                    </div>
                                                    {% else %} 
                                                    <div class="form-floating mb-3">
                                                        <div class="container" id="last_name">
                                                            {{update[0].last_name}}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>

                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <input type="text" class="form-control myinputs" id="short"
                                                            placeholder="-" name="short" required autocomplete="off" {% if update %}value = "{{update[1].short}}"{% endif %}>
                                                        <label for="short">Short Name</label>
                                                    </div>
                                                </div>

                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    {% if not update %}
                                                    <div class="form-floating mb-3">
                                                        <input type="text" class="form-control myinputs" id="email"
                                                            placeholder="-" name="email" required autocomplete="off">
                                                        <label for="email" >Email ID</label>
                                                    </div>
                                                    {% else %} 
                                                    <div class="form-floating mb-3">
                                                        <div class="container" id="last_name">
                                                            {{update[0].email}}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <input type="password" class="form-control myinputs" id="myinput1" name="password1" required autocomplete="off">
                                                        <label for="password1">Password</label>
                                                        <span id="eye_double" onclick="visibility1(parent)">
                                                            <i class="fa fa-eye fa-lg" id="hide1" aria-hidden="true"></i>
                                                            <i class="fa fa-eye-slash fa-lg" id="hide2" aria-hidden="true"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <input type="password" class="form-control myinputs" id="myinput2" name="password2" required autocomplete="off">
                                                        <label for="password2">Confirm Password</label>
                                                        <span id="eye_double" onclick="visibility2(parent)">
                                                            <i class="fa fa-eye fa-lg" id="hide3" aria-hidden="true"></i>
                                                            <i class="fa fa-eye-slash fa-lg" id="hide4" aria-hidden="true"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="container mt-4" style="width:80%;">
                                                    <button type="submit" class="btn btn-outline-success"
                                                        style="width:100%">Submit</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="second_page">
                                            <div class="row mb-3 mx-lg-5 mx-sm-0">
                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" class="form-control myinputs" id="load"
                                                            placeholder="-" name="total_load" required autocomplete="off" {% if update
                                                                %}value={{update[2].total_load}}{% endif %}>
                                                        <label for="load" >Total Load of Faculty(in hrs)</label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                    <div class="select2_container double_select2">
                                                        <select name="Designation_id" id="designations">
                                                          <option disabled {% if not update %}selected{% endif %}>Select Designation</option>
                                                          {% for designation in designations %}
                                                          <option value="{{designation.id}}" {% if update and designation.id==update[1].Designation_id_id%}selected{%
                                                            endif %}>
                                                            {{designation}}
                                                          </option>
                                                          {%endfor%}
                                                        </select>
                                                      </div>
                                                      </div>
                                                </div>
                                                <div class="col-lg-6 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <div class="select2_container double_select2">
                                                            <select name="Shift_id" id="shifts">
                                                              <option disabled {% if not update %}selected{% endif %}>Select Shift</option>
                                                              {% for shift in my_shifts %}
                                                              <option value="{{shift.id}}" {% if update and shift.id==update[1].Shift_id_id%}selected{% endif %}>
                                                                {{shift}}
                                                              </option>
                                                              {%endfor%}
                                                            </select>
                                                          </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="third_page">
                                            <div class="row mb-3 mx-lg-5 mx-sm-0">
                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                    <div class="form-floating mb-3">
                                                        <div class="can_container">
                                                            <!-- <img class="input_icons caret" src="{{static ('admin/details/img/caret.png')}}" alt=""> -->
                                                            <ul id="branches">
                                                
                                                              {%for branch in my_branches%}
                                                              <li class="branch">
                                                                <div class="form-check">
                                                                    <input type="checkbox" class="form-check-input" id="branch_{{branch.id}}">
                                                                    <label for="branch_{{branch.id}}">{{branch}}</label>
                                                                </div>
                                                                <ul id="semesters" class="dir">
                                                                  {%for sem in my_sems %}{% if sem.Branch_id == branch %}
                                                                  <li>
                                                                    <div class="form-check">
                                                                        <input type="checkbox" class="form-check-input" id="sem_{{sem.id}}">
                                                                        <label for="sem_{{sem.id}}">{{sem}}</label>
                                                                    </div>
                                                                    <ul id="subjects">
                                                                      {%for subject in my_subjects%}{% if subject.Semester_id == sem %}
                                                                      <li>
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" name="subject" type="checkbox" id="subject_{{subject.id}}" value="{{subject.id}}" {% if
                                                                                update and subject.id in update[3]%}checked{% endif %} />
                                                                            <label for="subject_{{subject.id}}">{{subject}}</label>
                                                                        </div>
                                                                      </li>
                                                                      {% endif %}{%endfor%}
                                                                    </ul>
                                                                  </li>
                                                                  {% endif %}{%endfor%}
                                                                </ul>
                                                              </li>
                                                              {%endfor%}
                                                            </ul>
                                                          </div>
                                                    </div>
                                                </div>
                                                <div class="container mt-4" style="width:80%;">
                                                    <button type="submit" class="btn btn-outline-success"
                                                        style="width:100%">Submit</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    {% if integrityErrors %}
                                        <div class="errors_container">
                                            <p>
                                            {{integrityErrors}}
                                            </p>
                                        </div>
                                    {% endif %}
                                    {% if errors %}
                                        <div class="errors_container">
                                            <p>
                                            {{errors}}
                                            </p>
                                        </div>
                                        <script>
                                            show_error("{{errors}}")
                                        </script>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid p-2 table_container">
            <div class="card shadow-sm mb-4 p-2 components-section" style="border-radius: 1rem;">
                <div class="card-body" style="border-radius: 1rem;">
                    <div class="row text-center">
                        <div class="col-lg-10 col-sm-12">
                            <div class="h3 text-center">Faculties For {{institute}}</div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <a style="display: none;" id="del" onclick="delete_entries()" >
                                <img class="input_icons" src="{{static ('admin/details/img/trash.png')}}" alt="Delete">
                            </a>
                        </div>
                    </div>
                    <div class="table">
                        <table class="table nowrap responsive compact mb-0 rounded text-center" id="example">
                            <thead class="thead-light">
                                <tr>
                                    <th class="border-0"><i class="fas fa-hashtag"></i></th>
                                    <th class="border-0 fw-bold">Short</th>
                                    <th class="border-0 fw-bold">Faculty Name</th>
                                    <th class="border-0 fw-bold">Designation</th>
                                    <th class="border-0 fw-bold">Load</th>
                                    <th class="border-0 fw-bold">Availibility</th>
                                    <th class="border-0 fw-bold">Edit</th>
                                    <th class="border-0 text-center">
                                        <div class="form-check" onclick="checkAll();">
                                            <input class="form-check-input" type="checkbox" value="parent"
                                                id="parent" name="parent">
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for load in my_faculty_load %}
                                    <tr>
                                        <td class="border-0 fw-bold">{{loop.index}}</td>
                                        <td class="border-0 fw-bold">{{load.Faculty_id.short}}</td>
                                        <td class="border-0 fw-bold">{{load.Faculty_id.User_id}}</td>
                                        <td class="border-0 fw-bold">{{load.Faculty_id.Designation_id}}</td>
                                        <td class="border-0 fw-bold">{{load.total_load}}</td>
                                        <td class="border-0 fw-bold">
                                            <a href="{{url ('show_not_avail' ,args=[load.Faculty_id.id])}}">
                                                <i class="fas fa-sign-in-alt"></i>
                                            </a>
                                        </td>
                                        <td class="border-0 fw-bold">
                                            <a href="{{url ('update_faculty' ,args=[my_department.id,load.Faculty_id.id])}}">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        </td>
                                        <td class="border-0 ">
                                            <div class="form-check" onclick="checkSelected()">
                                                <input class="form-check-input del_input" type="checkbox"
                                                id="{{loop.index}}" name="del" value="{{load.Faculty_id.id}}"  input_name="{{load.Faculty_id.User_id}}">
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}